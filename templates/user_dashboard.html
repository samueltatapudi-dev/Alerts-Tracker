{% extends 'base.html' %}
{% block title %}User Dashboard | Alerts & Tracker{% endblock %}
{% block content %}
<h1 class="mb-4">Tasks for {{ email }}</h1>
<audio id="newTaskAudio" src="{{ url_for('static', filename='audio/alert.wav') }}" preload="auto"></audio>
<div class="row g-4">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="card-title mb-0">Assigned Tasks</h5>
          <small class="text-muted">Auto-refreshing</small>
        </div>
        <div class="table-responsive">
          <table class="table table-hover align-middle" id="userTasksTable" data-user="{{ email }}">
            <thead class="table-light">
              <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="4" class="text-center text-muted">Loading tasks...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="card h-100">
      <div class="card-body">
        <h5 class="card-title">Performance Summary</h5>
        <ul class="list-group list-group-flush" id="userSummary">
          <li class="list-group-item d-flex justify-content-between">
            <span>Avg Completion</span>
            <span id="summaryAvgCompletion">â€”</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>Completed</span>
            <span id="summaryCompleted">0</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>Pending</span>
            <span id="summaryPending">0</span>
          </li>
        </ul>
        <div class="mt-3">
          <h6 class="text-muted">AI Suggestion</h6>
          <p id="summarySuggestion" class="mb-0">Hold tight while we gather your insights...</p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    initUserDashboard({{ email|tojson }}, {{ user_token|tojson }});
  });
</script>
{% endblock %}
